#!/usr/bin/env bash
# lock-quote by Amory Meltzer
# Stochastically change the lock screen quote in OSX from a quotes file

while getopts 'f:' opt; do
    case $opt in
	f) quotefile=$OPTARG;;
    esac
done

if [[ ! -e "$quotefile" ]]; then
    # Get this script's directory: http://stackoverflow.com/a/246128/2521092
    DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
    quotefile=$DIR/lockscreen_quotes.txt
fi

# OSX doesn't have shuf, approximate it via perl
# https://stackoverflow.com/a/6511327/2521092
if [[ ! $(which shuf) ]]; then
    function shuf() {
	perl -MList::Util=shuffle -e 'print shuffle(<>);' "$@";
    }
fi
qo=$(shuf < $quotefile | head -n 1 | tr -d '\n')
qo=$(echo "$qo" | sed -Ee 's/\[|\]//g' | sed -e "s/\"//g" | sed -e 's/ - / \]- /' | tr ] '\n')

defaults write /Library/Preferences/com.apple.loginwindow.plist LoginwindowText "$qo"
